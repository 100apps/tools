#!/Applications/XAMPP/xamppfiles/bin/php
<?php
$s="#GENERATED BY make.php AT ".date("Y-m-d H:i:s").".\n#@author:Liu Guangfeng\n#@email:email@liuguangfeng.cn\n\nNameVirtualHost *:80\n";
$workDir="/Applications/XAMPP/xamppfiles/htdocs/";
$dir=opendir($workDir);
$i=0;
$owners=array();
while(($owner=readdir($dir))!==false){
  if(is_dir($workDir.$owner)&&$owner!="img"&&$owner!="."&&$owner!=".."&&$owner!="xampp"&&$owner!="webalizer"){
    $owners[]=$owner;
  }
}
unset($owner);
sort($owners);
foreach($owners as $owner){
    //so i go to your dir.
    $yourdir=opendir($workDir.$owner);
    $s.="\n########for {$owner}\n";
    while(($site=readdir($yourdir))!==false){
      if(is_dir($workDir.$owner."/".$site)&&$site!="."&&$site!=".."){
        $i++;$realpath=$workDir ."/{$owner}/{$site}";
        $s.=<<<EOF
<VirtualHost *:80>
    ServerAdmin admin@{$site}
    DocumentRoot "{$realpath}"
    ServerName {$site}
    ServerAlias local.{$site}
    ErrorLog "{$realpath}/{$site}-error.log"
    CustomLog "{$realpath}/{$site}-access.log" combined
</VirtualHost>

EOF;
      }
    }
}

file_put_contents("/Applications/XAMPP/xamppfiles/etc/extra/httpd-vhosts.conf",$s);
echo "i found {$i} sites in total\nrestarting apache";
exec("/Applications/XAMPP/xamppfiles/xampp restartapache",$out);
foreach($out as $v)echo $v."\n";

